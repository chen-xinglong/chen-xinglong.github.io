
# 第二章 微型计算机组成结构（硬件）

- 硬件，基于Intel80X86中央处理器的IBM PC微型计算机及其兼容机的硬件系统
- 软件，Linux操作系统内核  

术语：
- PC/AT 指具有80386或以上CPU的IBM PC及其兼容微机

## 2.1微型计算机组成原理

### CPU总线
CPU通过本地总线（或成为内部总线）与系统其他部分进行数据通信，总线由：
- 地址线（用于提供内存或I/O设备的地址）
- 数据线
- 控制信号线
三部分组成，对于80386CPU的PC机，其内部地址线和数据线都分别有32根。因此地址寻址空间范围有2^32字节，从0到4GB。 

### 控制器
控制器举例：  
- 中断控制器：Intel 8259A或其兼容芯片  
- DMA控制器： Intel8237A芯片  
- 定时计数器： Intel 8253/8254定时芯片  
- 键盘控制器： Intel 8042芯片与键盘中的扫描电路进行通信。

### 控制卡（适配器）
控制卡（适配器）通过扩展插槽与主板上系统总线连接。  
总线插槽是系统地址总线、数据总线和控制线的与扩展设备控制器的标准连接接口。  

总线接口标准：
- 工业结构标准ISA（Industry Standard Architecture）  
- 扩展工业标准结构总线EISA（Extended ISA）  
- 外围组件互连PCI（Peripheral Component Interconnect）总线  
- 加速图形端口AGP（Accelerated Graphics Port）视频总线  
- 高速PCIE（PCI Express）总线  

**最初的80386机器上只有ISA总线，因此系统与外部I/O设备最多只能使用16位数据线进行数据传输**

### 现代PC结构
主要使用两个超大规模芯片构成的芯片组或芯片集（chipsets）组成：
- 北桥（Northbridge）芯片，用于与CPU、内存、AGP视频接口，这些接口有很高的传输速率。还有存储器控制作用，又被称为MCH（Memory Controller Hub）芯片   
- 南桥（Southbridge）芯片，用来管理低中速的组件，如PCI总线、IDE硬盘、USB端口等。南桥又被称为ICH（I/O Controller Hub）

## 2.2 I/O端口和寻址

### I/O端口地址（简称端口）

CPU为了访问I/O接口控制器或控制卡上的数据和状态信息，需要首先指定它们的地址。**这种地址就称为I/O端口地址或者简称端口**

端口地址设置方法：  
- 统一编址（存储器映像编址）  
- 独立编址  

### 2.2.2 接口访问控制

PC机I/O接口数据传输控制方式：  
- 程序循环查询方式  
- **中断处理方式**（需要中断控制器，使用中断向量表）（**主要方式**）  
- 直接存储器访问DMA（Direct Memory Access）传输方式（用于I/O设备与系统内存之间，无需CPU，需要专门的DMA控制器）  

## 2.3 主存储器、BIOS和CMOS存储器

### 2.3.1 主存储器

- 1981年IBM PC机系统只带有640KB的RAM主存储器（简称内存）。由于所采用的8088/8086CPU只有20根地址线，因此内存寻址范围最高位1024KB（1MB）。  
- 为了与原来的PC机在软件上兼容，系统1MB以下物理内存使用分配上仍然保持与原来PC机基本一致。  
- 计算机上电初始化时，物理地址被设置为从地址0开始的连续区域。除了地址从0xA0000到0xFFFFF(640K到1M共384K)和0xFFFF0000到0xFFFFFFFF（4G处的最后一64K）范围外的所有内存都可以用作系统内存。这两个特定范围被用于I/O设备和BIOS程序。    

### 2.3.2 基本输入/输出程序 BIOS

- 存放在ROM中的系统BIOS程序主要用于计算机开机时执行系统各部分的自检，建立操作系统需要使用的各种配置表。  

-----

当计算机系统上电开机或者按了机箱上的复位按钮时：  

- CPU会自动把代码段寄存器CS设置为0xF000，其段基地址设置为0xFFFF0000，段长度设置为64KB。  
- IP设置为0xFFF0  
- 因此，此时CPU代码指针指向0xFFFFFFF0处，即4G空间最后一个64K的最后16字节处。由上节可知，这里正是ROM BIOS存放的位置。  
- 并且BIOS会在此位置存放一条跳转指令JMP跳转到BIOS代码中64KB范围内的某一条指令开始执行。  
- BIOS在执行了一些列硬件检测和初始化操作之后，就会把与原来PC机兼容的64KB BIOS代码和数据复制到内存低端1M末端的64K处，然后跳转到这个地方并且让CPU进入真正的实地址模式工作。  
- 最后BIOS就会硬盘或其他块设备把操作系统引导程序加载到内存0x7c00（31KB）处，并跳转到这个地方继续执行引导程序。

### 2.3.3 CMOS存储器

CMOS（Complementary Metal Oxide Semiconductor，互补金属氧化物半导体）  

CMOS用来存放计算机的实时时钟信息和系统硬件配置信息。需要I/O指令访问CMOS内存。  

## 2.4 控制器和控制卡

- 使用两片级联的8259A可编程中断控制芯片，组成一个中断控制器。能为15个设备提供独立的中断控制功能。  
- 开机时ROM BIOS会对8259A芯片初始化。同时在内存开始处0x000-0xFFF区域建立一个中断向量表。  
- Linux操作系统在内核初始化期间重新对8259A进行了设置。  

### 2.4.2 DMA控制器

- DMA控制器的主要功能是通过让外部设备直接与内存传输数据来增强系统的性能。  
- 通常，它由机器上的Intel 8237芯片或其兼容芯片实现。  
- PC/AT机中，使用了两片8237芯片，DMA控制器有八个独立通道可使用。其中后四个是16位通道。  
- 软盘控制器使用DMA通道2。   
- DMA寄存器是8位，地址和计数值是16位值，因此需要各自发送两次。

### 2.4.3 定时/计数器
- **Intel 8253/8254** 是可编程定时/计数器(PIT-Programmable Interval Timer)芯片，用于处理计算机中的精准时间延迟。  
- 该芯片提供3个独立16位计数器通道。  
- 在软件中实现延时，使用8253/8254执行循环语句，延时到后向CPU发送中断信号。  

---
- PC/AT及其兼容微机采用8254芯片。  
- 3个定时/计数器通道被分别用于日时钟计时中断信号、动态内存DRAM刷新定时电路和主机扬声器音调合成。  
- LinuxO.11操作系统只对通道0进行了重新设置，使得该计数器工作在**方式3**（*方式三是什么？*）下，并且每间隔10毫秒发出一个信号以产生中断请求信号（IRQ0）。这个间隔定时产生的中断请求就是Linux0.11内核工作的脉搏，它用于定时切换当前执行的任务和统计每个任务使用的系统资源量（时间）。  

### 2.4.4 键盘控制器

折叠测试 ：

<details>
  <summary>什么是iuap design</summary>
  iuap design 是用友网络FED团队开发的企业级应用前端集成解决方案。
</details>










2024.10.16-   云南昆明