
## 3.3 C语言程序

GNU gcc 对 ISO 标准 C89 描述的 C语言进行了一些扩展。

### 3.3.1 C程序编译和链接

使用gcc汇编器编译C语言程序时通常会经过四个处理阶段，即**预处理阶段、编译阶段、汇编阶段和链接阶段**，如下图所示。

![p3-1](../linux011image/p3-c/p3-1.png)


- 在前处理阶段中，gcc 会把C程序传递给 C 前处理器CPP，对 C语言程序中**指示符和宏**进行替换处理，
输出纯C语言代码；

- 在编译阶段，gcc把C语言程序编译生成对应的与机器相关的as汇编语言代码；

- 在汇编阶段，as汇编器会把汇编代码转换成机器指令，并以特定二进制格式输出保存在标文件中；最后GNU ld链接器把程序的相关目标文件组合链接在一起，生成程序的可执行映像文件。调用gcc的命令行格式与编译汇编语言的格式类似：

`gcc [选项] [-o outfile] infile ...`

其中 infile 是输入的 C 语言文件；outfile 是编译产生的输出文件。对于某次编译过程，并非一定要全部执行这四个阶段，使用命令行选项可以令gcc 编译过程在某个处理阶段后就停止执行。例如，使用`-S` 选项可以让 gcc 在输出了 程序对应的汇编语言程序之后就停止运行；使用`-c`选项可以让 gcc 只生成目标文件而不执行链接处理，见如下所示。


- `gcc -o hello hello.c ` //编译 hello.c 程序，生成执行文件 hello。

- `gcc -S -o hello.s hello.c` /／编译 hello.c 程序，生成对应汇编程序 hello.s。 

-  `gcc -c -o hello.o hello.c`　/／编译hello.c 程序，生成对应目标文件hello.o而不链接。


---

在编译象Linux 内核这样的包含很多源程序文件的大型程序时，通常使用 make 工具软件对整个程序的编译过程进行自动管理，详见后面说明。

### 3.3.2 嵌入汇编